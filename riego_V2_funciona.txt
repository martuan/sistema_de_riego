//#include <WiFi.h>
#include "time.h"
//#include <AsyncTCP.h>
//#include <ESPAsyncWebServer.h>
#include <WiFi.h>
#include <WiFiClient.h>
#include <WebServer.h>
#include <ESPmDNS.h>
#include <EEPROM.h>


#define OUTPUT1 15
#define OUTPUT2 22
#define FLASH 4


#define LED_ONBOARD 2 //On Board LED

//uint32_t time = 2000;
#define time 2000

#define EEPROM_SIZE 200

#define EEPROM_tiempoConfiguradoON1 0//String (8 bytes)
#define EEPROM_tiempoConfiguradoOFF1 10//String (8 bytes)
#define EEPROM_tiempoConfiguradoON2 20//String (8 bytes)
#define EEPROM_tiempoConfiguradoOFF2 30//String (8 bytes)
#define EEPROM_tiempoConfiguradoON3 40//String (8 bytes)
#define EEPROM_tiempoConfiguradoOFF3 50//String (8 bytes)
#define EEPROM_tiempoConfiguradoON4 60//String (8 bytes)
#define EEPROM_tiempoConfiguradoOFF4 70//String (8 bytes)

//#define EEPROM_ADDRESS_NUMSENSOR 10//uint8_t (1 byte)
//#define EEPROM_ADDRESS_MQTT_SERVER 100//String

//enum salidas {OUTPUT1,OUTPUT2,OUTPUT3,OUTPUT4}salida;

//const char* ssid     = "milton";
//const char* password = "paternal";
const char* ssid = "wifi01-ei";
const char* password =  "Ax32MnF1975-ReB";

hw_timer_t * timer;

//**** NTP CONFIG (hora mundial) ********
const char* ntpServer = "pool.ntp.org";//server del rtc global
const long  gmtOffset_sec = -10800;//3600;
const int   daylightOffset_sec = 0;//3600;

struct tm timeStamp;

char timeYear[10];
char timeMonth[10];
char timeDayName[10];
char timeDayNumber[10];
char timeHour24[10];
char timeHour12[10];
char timeMinute[10];
char timeSecond[10];
char fechaHora[50];
/*
String tiempoConfiguradoON1 = {};
String tiempoConfiguradoOFF1 = {};
String tiempoConfiguradoON2 = {};
String tiempoConfiguradoOFF2 = {};
String tiempoConfiguradoON3 = {};
String tiempoConfiguradoOFF3 = {};
String tiempoConfiguradoON4 = {};
String tiempoConfiguradoOFF4 = {};
*/
String tiempoConfiguradoON1 = "00:00:00";
String tiempoConfiguradoOFF1 = "00:00:00";
String tiempoConfiguradoON2 = "00:00:00";
String tiempoConfiguradoOFF2 = "00:00:00";
String tiempoConfiguradoON3 = "00:00:00";
String tiempoConfiguradoOFF3 = "00:00:00";
String tiempoConfiguradoON4 = "00:00:00";
String tiempoConfiguradoOFF4 = "00:00:00";

String tiempoActual = {};

String horaON1 = {};
String minutoON1 = {};
String horaOFF1 = {};
String minutoOFF1 = {};
String horaON2 = {};
String minutoON2 = {};
String horaOFF2 = {};
String minutoOFF2 = {}; 
String horaON3 = {};
String minutoON3 = {};
String horaOFF3 = {};
String minutoOFF3 = {}; 
String horaON4 = {};
String minutoON4 = {};
String horaOFF4 = {};
String minutoOFF4 = {};  
String preset1 = {};
String preset2 = {};
String preset3 = {};
String preset4 = {};

//**** NTP CONFIG (hora mundial) ********




char flagTimer = 0;
int contadorTimer = 0;
char flagProceso1 = 0;
char flagProceso2 = 0;
int contadorProceso1 = 0;
int contadorProceso2 = 0;
int tiempo1 = 1;
int tiempo2 = 1;
int milisegundos = 1000;//1 segundo

String startHtml = "<!DOCTYPE HTML><html>\
                      <head>\
                        <title>ESP Web Server</title>\
                        <link rel='stylesheet' href='bootstrap/css/bootstrap.min.css'>\
                      </head>\
                      <body>";

String endHtml = "</body></html>";                      

const char* PARAM_INPUT_1 = "output";
const char* PARAM_INPUT_2 = "state";

// Create AsyncWebServer object on port 80
//AsyncWebServer server(80);

const char index_html[] PROGMEM = R"rawliteral(
<!DOCTYPE HTML><html>
<head>
  <title>ESP Web Server</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="icon" href="data:,">
  <style>
    html {font-family: Arial; display: inline-block; text-align: center;}
    h2 {font-size: 3.0rem;}
    p {font-size: 3.0rem;}
    body {max-width: 600px; margin:0px auto; padding-bottom: 25px;}
    .switch {position: relative; display: inline-block; width: 120px; height: 68px} 
    .switch input {display: none}
    .slider {position: absolute; top: 0; left: 0; right: 0; bottom: 0; background-color: #ccc; border-radius: 6px}
    .slider:before {position: absolute; content: ""; height: 52px; width: 52px; left: 8px; bottom: 8px; background-color: #fff; -webkit-transition: .4s; transition: .4s; border-radius: 3px}
    input:checked+.slider {background-color: #b30000}
    input:checked+.slider:before {-webkit-transform: translateX(52px); -ms-transform: translateX(52px); transform: translateX(52px)}
  </style>
</head>
<body>
  <h2>ESP Web Server</h2>
  %BUTTONPLACEHOLDER%
<script>function toggleCheckbox(element) {
  var xhr = new XMLHttpRequest();
  if(element.checked){ xhr.open("GET", "/update?output="+element.id+"&state=1", true); }
  else { xhr.open("GET", "/update?output="+element.id+"&state=0", true); }
  xhr.send();
}
</script>
</body>
</html>
)rawliteral";

/*
// Replaces placeholder with button section in your web page
String processor(const String& var){
  //Serial.println(var);
  if(var == "BUTTONPLACEHOLDER"){
    String buttons = "";
    buttons += "<h4>Output - GPIO 2</h4><label class=\"switch\"><input type=\"checkbox\" onchange=\"toggleCheckbox(this)\" id=\"2\" " + outputState(2) + "><span class=\"slider\"></span></label>";
    buttons += "<h4>Output - GPIO 4</h4><label class=\"switch\"><input type=\"checkbox\" onchange=\"toggleCheckbox(this)\" id=\"4\" " + outputState(4) + "><span class=\"slider\"></span></label>";
    buttons += "<h4>Output - GPIO 33</h4><label class=\"switch\"><input type=\"checkbox\" onchange=\"toggleCheckbox(this)\" id=\"33\" " + outputState(33) + "><span class=\"slider\"></span></label>";
    return buttons;
  }
  return String();
}

String outputState(int output){
  if(digitalRead(output)){
    return "checked";
  }
  else {
    return "";
  }
}
*/

WebServer server(80);

const int led = 4;


//************ FUNCIONES *****************


void accionarSalidas(void);
void writeString(char add,String data);
String read_String(char add);
void handleNotFound (void);
void handleMenu(void);
void handleRoot(void);



//timer de usos generales 1ms
void IRAM_ATTR onTimer() {

    contadorProceso1++;
    contadorProceso2++;

    if(contadorProceso1 == tiempo1){//proceso 1
        contadorProceso1 = 0;//resetea el contador
        flagProceso1 = 1;        
        //Serial.println("flagProceso1");
    }
    if(contadorProceso2 == tiempo2){//proceso 2
        contadorProceso1 = 0;//resetea el contador
        //contadorProceso2 = 0;//resetea el contador
        flagProceso2 = 1; 
        //Serial.println("flagProceso2");
    }
}

void setup(){


    Serial.begin(115200);
    Serial.println("Sistema de riego Encendido");
    
    
    pinMode(OUTPUT1, OUTPUT);
    pinMode(OUTPUT2, OUTPUT);
    pinMode(LED_ONBOARD, OUTPUT);
    pinMode(FLASH, OUTPUT);

    digitalWrite(OUTPUT1, HIGH);
    
    
    //configuración de timer para usos generales // 1ms
    timer = timerBegin(2, 80, true);
    timerAttachInterrupt(timer, &onTimer, true);
    //timerAlarmWrite(timer, 1000, true);//valor en microsegundos
    timerAlarmWrite(timer, milisegundos * 1000, true);//valor en microsegundos
    timerAlarmEnable(timer);

    

    // Connect to Wi-Fi
    Serial.print("Connecting to ");
    Serial.println(ssid);
    
    WiFi.begin(ssid, password);
    while (WiFi.status() != WL_CONNECTED) {
        delay(500);
        Serial.print(".");
    }
    Serial.println("");
    Serial.println("WiFi connected.");

    Serial.println(WiFi.localIP());

        //init and get the time
    configTime(gmtOffset_sec, daylightOffset_sec, ntpServer);
/*
    tiempoConfiguradoON1 = "";
    tiempoConfiguradoOFF1 = "";
    tiempoConfiguradoON2 = "";
    tiempoConfiguradoOFF2 = "";
    tiempoConfiguradoON3 = "";
    tiempoConfiguradoOFF3 = "";
    tiempoConfiguradoON4 = "";
    tiempoConfiguradoOFF4 = "";
  */  

    cargarDesdeEEPROM();

    //tiempoConfiguradoON1 = "20:55:00";
    //tiempoConfiguradoOFF1 = "20:56:00";

    // Route for root / web page
    /*
    server.on("/", HTTP_GET, [](AsyncWebServerRequest *request){
        request->send_P(200, "text/html", index_html, processor);
    });
*/

/*
    server.on("/", HTTP_GET, [](AsyncWebServerRequest *request){
        request->send(200, "text/html", index_html);
    });

    // Send a GET request to <ESP_IP>/update?output=<inputMessage1>&state=<inputMessage2>
    server.on("/update", HTTP_GET, [] (AsyncWebServerRequest *request) {
        String inputMessage1;
        String inputMessage2;
        // GET input1 value on <ESP_IP>/update?output=<inputMessage1>&state=<inputMessage2>
        if (request->hasParam(PARAM_INPUT_1) && request->hasParam(PARAM_INPUT_2)) {
        inputMessage1 = request->getParam(PARAM_INPUT_1)->value();
        inputMessage2 = request->getParam(PARAM_INPUT_2)->value();
        digitalWrite(inputMessage1.toInt(), inputMessage2.toInt());
        }
        else {
        inputMessage1 = "No message sent";
        inputMessage2 = "No message sent";
        }
        Serial.print("GPIO: ");
        Serial.print(inputMessage1);
        Serial.print(" - Set to: ");
        Serial.println(inputMessage2);
        request->send(200, "text/plain", "OK");
    });

    // Start server
    server.begin();
*/
    if (MDNS.begin("esp32")) {
      Serial.println("MDNS responder started");
    }

    server.on("/", handleRoot);
    server.on("/menu", handleMenu);
/*
    server.on("/", []() {
      server.send(200, "text/plain", index_html);
    });
    */
   /*
    server.on("/", []() {
      //server.send(200, "text/html", "<!DOCTYPE HTML><html><head><title>ESP Web Server</title></head><body><p>Hola</p></body></html>");
    });
    
*/

    //server.send(200, "text/plain", "this works as well");

    server.on("/inline", []() {
      server.send(200, "text/plain", "this works as well");
    });

    server.onNotFound(handleNotFound);

    server.begin();
    Serial.println("HTTP server started");


    

}

void loop(){

 
    server.handleClient();

    if(flagProceso1){//si el timer alcanzó el tiempo para encender la electroválvula
        Serial.println("flagProceso1");
        flagProceso1 = 0;
        
        
        //digitalWrite(FLASH, HIGH);
        //accionarSalidas();
        obtenerFechaHora();
        Serial.println(fechaHora);
        Serial.println(tiempoActual);
        
        if(tiempoActual == tiempoConfiguradoON1 && preset1 == "ON"){

          digitalWrite(OUTPUT1, LOW);//logica inversa
          Serial.println("ON1");

        }else if(tiempoActual == tiempoConfiguradoOFF1 && preset1 == "ON"){

          digitalWrite(OUTPUT1, HIGH);//logica inversa
          Serial.println("OFF2");

        }else if(tiempoActual == tiempoConfiguradoON2 && preset2 == "ON"){

          digitalWrite(OUTPUT1, LOW);//logica inversa
          Serial.println("ON2");

        }else if(tiempoActual == tiempoConfiguradoOFF2 && preset2 == "ON"){

          digitalWrite(OUTPUT1, HIGH);//logica inversa
          Serial.println("OFF2");

        }else if(tiempoActual == tiempoConfiguradoON3 && preset3 == "ON"){

          digitalWrite(OUTPUT1, LOW);//logica inversa
          Serial.println("ON3");

        }else if(tiempoActual == tiempoConfiguradoOFF3 && preset3 == "ON"){

          digitalWrite(OUTPUT1, HIGH);//logica inversa
          Serial.println("OFF3");

        }else if(tiempoActual == tiempoConfiguradoON4 && preset4 == "ON"){

          digitalWrite(OUTPUT1, LOW);//logica inversa
          Serial.println("ON4");

        }else if(tiempoActual == tiempoConfiguradoOFF4 && preset4 == "ON"){

          digitalWrite(OUTPUT1, HIGH);//logica inversa
          Serial.println("OFF4");

        }

    }


    /*
    if(flagProceso2){//si el timer alcanzó el tiempo para apagar la electroválvula
        Serial.println("flagProceso2");
        flagProceso2 = 0;

        digitalWrite(OUTPUT1, LOW);
        //digitalWrite(FLASH, LOW);
        //accionarSalidas();
    }
    */
/*
    Serial.print(timeHour24);
    Serial.print(":");
    Serial.print(timeMinute);
    Serial.print(":");
    Serial.println(timeSecond); 
*/
    

    

    
}

void accionarSalidas(void){


        digitalWrite(OUTPUT1, HIGH);
        delay(2000);
        digitalWrite(OUTPUT1, LOW);
        

}

//realiza la lectura del timestamp desde el server ntp
void obtenerFechaHora(void){

  if(!getLocalTime(&timeStamp)){
      Serial.println("Failed to obtain time");
  }else{

      //guarda cada componente del timeStamp en variables
      strftime(timeYear,10, "%Y", &timeStamp);
      strftime(timeMonth,10, "%B", &timeStamp);
      strftime(timeDayName,10, "%A", &timeStamp);
      strftime(timeDayNumber,10, "%d", &timeStamp);
      strftime(timeHour24,10, "%H", &timeStamp);   
      strftime(timeHour12,10, "%I", &timeStamp);
      strftime(timeMinute,10, "%M", &timeStamp);
      strftime(timeSecond,10, "%S", &timeStamp);
      
      strcpy(fechaHora, "");//borra el contenido del string

      //arma un string con los componentes que interesan
      strcat(fechaHora, timeYear);
      strcat(fechaHora, " ");
      strcat(fechaHora, timeMonth);
      strcat(fechaHora, " ");
      strcat(fechaHora, timeDayNumber);
      strcat(fechaHora, " ");
      strcat(fechaHora, timeHour24);
      strcat(fechaHora, ":");
      strcat(fechaHora, timeMinute);
      strcat(fechaHora, ":");
      strcat(fechaHora, timeSecond);

      tiempoActual = String(timeHour24) + ":" + String(timeMinute) + ":" + String(timeSecond);

  }
}

void cargarDesdeEEPROM(void){

  // initialize EEPROM with predefined size
  EEPROM.begin(EEPROM_SIZE);
  
  tiempoConfiguradoON1 = EEPROM.readString(EEPROM_tiempoConfiguradoON1);//lee tiempoConfigurado de la eeprom
  Serial.print("tiempoConfiguradoON1 EEPROM: ");
  Serial.println(tiempoConfiguradoON1);

  tiempoConfiguradoOFF1 = EEPROM.readString(EEPROM_tiempoConfiguradoOFF1);//lee tiempoConfigurado de la eeprom
  Serial.print("tiempoConfiguradoOFF1 EEPROM: ");
  Serial.println(tiempoConfiguradoOFF1);

  tiempoConfiguradoON2 = EEPROM.readString(EEPROM_tiempoConfiguradoON2);//lee tiempoConfigurado de la eeprom
  Serial.print("tiempoConfiguradoON2 EEPROM: ");
  Serial.println(tiempoConfiguradoON2);

  tiempoConfiguradoOFF2 = EEPROM.readString(EEPROM_tiempoConfiguradoOFF2);//lee tiempoConfigurado de la eeprom
  Serial.print("tiempoConfiguradoOFF2 EEPROM: ");
  Serial.println(tiempoConfiguradoOFF2);

  tiempoConfiguradoON3 = EEPROM.readString(EEPROM_tiempoConfiguradoON3);//lee tiempoConfigurado de la eeprom
  Serial.print("tiempoConfiguradoON3 EEPROM: ");
  Serial.println(tiempoConfiguradoON3);

  tiempoConfiguradoOFF3 = EEPROM.readString(EEPROM_tiempoConfiguradoOFF3);//lee tiempoConfigurado de la eeprom
  Serial.print("tiempoConfiguradoOFF3 EEPROM: ");
  Serial.println(tiempoConfiguradoOFF3);

  tiempoConfiguradoON4 = EEPROM.readString(EEPROM_tiempoConfiguradoON4);//lee tiempoConfigurado de la eeprom
  Serial.print("tiempoConfiguradoON4 EEPROM: ");
  Serial.println(tiempoConfiguradoON4);

  tiempoConfiguradoOFF4 = EEPROM.readString(EEPROM_tiempoConfiguradoOFF4);//lee tiempoConfigurado de la eeprom
  Serial.print("tiempoConfiguradoOFF4 EEPROM: ");
  Serial.println(tiempoConfiguradoOFF4);
 
  //cambiarConfigMQTT(numeroSensor);

}

void writeString(char add,String data)
{
  int _size = data.length();
  int i;
  for(i=0;i<_size;i++)
  {
    EEPROM.write(add+i,data[i]);
  }
  EEPROM.write(add+_size,'\0');   //Add termination null character for String Data
  EEPROM.commit();
}


String read_String(char add)
{
  int i;
  char data[100]; //Max 100 Bytes
  int len=0;
  unsigned char k;
  k=EEPROM.read(add);
  while(k != '\0' && len<500)   //Read until null character
  {    
    k=EEPROM.read(add+len);
    data[len]=k;
    len++;
  }
  data[len]='\0';
  return String(data);
}

void handleRoot() {
  //digitalWrite(led, 1);
 /* 
  String htmlToSend = startHtml + "<form action = '/menu' method = 'POST'>\
                        <label for='horaON1'>HoraON1:</label><br>\
                        <input type='text' id='horaON1' name='horaON1' value=''><br>\
                        <label for='minutoON1'>MinutoON1:</label><br>\
                        <input type='text' id='minutoON1' name='minutoON1' value=''><br><br>\
                        <label for='horaOFF1'>HoraOFF1:</label><br>\
                        <input type='text' id='horaOFF1' name='horaOFF1' value=''><br>\
                        <label for='minutoOFF1'>MinutoOFF1:</label><br>\
                        <input type='text' id='minutoOFF1' name='minutoOFF1' value=''><br><br>\
                        <input type='submit' value='Aceptar'>\
                      </form>" + endHtml;
*/

String htmlToSend = startHtml + "<form action = '/menu' method = 'POST'>\
                        <label for='horaON1'>HoraON1:</label>\
                          <select name='horaON1' id='horaON1'>\
                            <option value='00'>00</option>\
                            <option value='01'>01</option>\
                            <option value='02'>02</option>\
                            <option value='03'>03</option>\
                            <option value='04'>04</option>\
                            <option value='05'>05</option>\
                            <option value='06'>06</option>\
                            <option value='07'>07</option>\
                            <option value='08'>08</option>\
                            <option value='09'>09</option>\
                            <option value='10'>10</option>\
                            <option value='11'>11</option>\
                            <option value='12'>12</option>\
                            <option value='13'>13</option>\
                            <option value='14'>14</option>\
                            <option value='15'>15</option>\
                            <option value='16'>16</option>\
                            <option value='17'>17</option>\
                            <option value='18'>18</option>\
                            <option value='19'>19</option>\
                            <option value='20'>20</option>\
                            <option value='21'>21</option>\
                            <option value='22'>22</option>\
                            <option value='23'>23</option>\
                          </select>\
                        <label for='minutoON1'>MinutoON1:</label>\
                        <select name='minutoON1' id='minutoON1'>\
                            <option value='00'>00</option>\
                            <option value='01'>01</option>\
                            <option value='02'>02</option>\
                            <option value='03'>03</option>\
                            <option value='04'>04</option>\
                            <option value='05'>05</option>\
                            <option value='06'>06</option>\
                            <option value='07'>07</option>\
                            <option value='08'>08</option>\
                            <option value='09'>09</option>\
                            <option value='10'>10</option>\
                            <option value='11'>11</option>\
                            <option value='12'>12</option>\
                            <option value='13'>13</option>\
                            <option value='14'>14</option>\
                            <option value='15'>15</option>\
                            <option value='16'>16</option>\
                            <option value='17'>17</option>\
                            <option value='18'>18</option>\
                            <option value='19'>19</option>\
                            <option value='20'>20</option>\
                            <option value='21'>21</option>\
                            <option value='22'>22</option>\
                            <option value='23'>23</option>\
                            <option value='24'>24</option>\
                            <option value='25'>25</option>\
                            <option value='26'>26</option>\
                            <option value='27'>27</option>\
                            <option value='28'>28</option>\
                            <option value='29'>29</option>\
                            <option value='30'>30</option>\
                            <option value='31'>31</option>\
                            <option value='32'>32</option>\
                            <option value='33'>33</option>\
                            <option value='34'>34</option>\
                            <option value='35'>35</option>\
                            <option value='36'>36</option>\
                            <option value='37'>37</option>\
                            <option value='38'>38</option>\
                            <option value='39'>39</option>\
                            <option value='40'>40</option>\
                            <option value='41'>41</option>\
                            <option value='42'>42</option>\
                            <option value='43'>43</option>\
                            <option value='44'>44</option>\
                            <option value='45'>45</option>\
                            <option value='46'>46</option>\
                            <option value='47'>47</option>\
                            <option value='48'>48</option>\
                            <option value='49'>49</option>\
                            <option value='50'>50</option>\
                            <option value='51'>51</option>\
                            <option value='52'>52</option>\
                            <option value='53'>53</option>\
                            <option value='54'>54</option>\
                            <option value='55'>55</option>\
                            <option value='56'>56</option>\
                            <option value='57'>57</option>\
                            <option value='58'>58</option>\
                            <option value='59'>59</option>\
                          </select>\
                          <br>\
                        <label for='horaOFF1'>HoraOFF1:</label>\
                          <select name='horaOFF1' id='horaOFF1'>\
                            <option value='00'>00</option>\
                            <option value='01'>01</option>\
                            <option value='02'>02</option>\
                            <option value='03'>03</option>\
                            <option value='04'>04</option>\
                            <option value='05'>05</option>\
                            <option value='06'>06</option>\
                            <option value='07'>07</option>\
                            <option value='08'>08</option>\
                            <option value='09'>09</option>\
                            <option value='10'>10</option>\
                            <option value='11'>11</option>\
                            <option value='12'>12</option>\
                            <option value='13'>13</option>\
                            <option value='14'>14</option>\
                            <option value='15'>15</option>\
                            <option value='16'>16</option>\
                            <option value='17'>17</option>\
                            <option value='18'>18</option>\
                            <option value='19'>19</option>\
                            <option value='20'>20</option>\
                            <option value='21'>21</option>\
                            <option value='22'>22</option>\
                            <option value='23'>23</option>\
                          </select>\
                        <label for='minutoOFF1'>MinutoOFF1:</label>\
                        <select name='minutoOFF1' id='minutoOFF1'>\
                            <option value='00'>00</option>\
                            <option value='01'>01</option>\
                            <option value='02'>02</option>\
                            <option value='03'>03</option>\
                            <option value='04'>04</option>\
                            <option value='05'>05</option>\
                            <option value='06'>06</option>\
                            <option value='07'>07</option>\
                            <option value='08'>08</option>\
                            <option value='09'>09</option>\
                            <option value='10'>10</option>\
                            <option value='11'>11</option>\
                            <option value='12'>12</option>\
                            <option value='13'>13</option>\
                            <option value='14'>14</option>\
                            <option value='15'>15</option>\
                            <option value='16'>16</option>\
                            <option value='17'>17</option>\
                            <option value='18'>18</option>\
                            <option value='19'>19</option>\
                            <option value='20'>20</option>\
                            <option value='21'>21</option>\
                            <option value='22'>22</option>\
                            <option value='23'>23</option>\
                            <option value='24'>24</option>\
                            <option value='25'>25</option>\
                            <option value='26'>26</option>\
                            <option value='27'>27</option>\
                            <option value='28'>28</option>\
                            <option value='29'>29</option>\
                            <option value='30'>30</option>\
                            <option value='31'>31</option>\
                            <option value='32'>32</option>\
                            <option value='33'>33</option>\
                            <option value='34'>34</option>\
                            <option value='35'>35</option>\
                            <option value='36'>36</option>\
                            <option value='37'>37</option>\
                            <option value='38'>38</option>\
                            <option value='39'>39</option>\
                            <option value='40'>40</option>\
                            <option value='41'>41</option>\
                            <option value='42'>42</option>\
                            <option value='43'>43</option>\
                            <option value='44'>44</option>\
                            <option value='45'>45</option>\
                            <option value='46'>46</option>\
                            <option value='47'>47</option>\
                            <option value='48'>48</option>\
                            <option value='49'>49</option>\
                            <option value='50'>50</option>\
                            <option value='51'>51</option>\
                            <option value='52'>52</option>\
                            <option value='53'>53</option>\
                            <option value='54'>54</option>\
                            <option value='55'>55</option>\
                            <option value='56'>56</option>\
                            <option value='57'>57</option>\
                            <option value='58'>58</option>\
                            <option value='59'>59</option>\
                          </select>\
                          <br>\
                          <br>\
                          <label for='horaON2'>HoraON2:</label>\
                          <select name='horaON2' id='horaON2'>\
                            <option value='00'>00</option>\
                            <option value='01'>01</option>\
                            <option value='02'>02</option>\
                            <option value='03'>03</option>\
                            <option value='04'>04</option>\
                            <option value='05'>05</option>\
                            <option value='06'>06</option>\
                            <option value='07'>07</option>\
                            <option value='08'>08</option>\
                            <option value='09'>09</option>\
                            <option value='10'>10</option>\
                            <option value='11'>11</option>\
                            <option value='12'>12</option>\
                            <option value='13'>13</option>\
                            <option value='14'>14</option>\
                            <option value='15'>15</option>\
                            <option value='16'>16</option>\
                            <option value='17'>17</option>\
                            <option value='18'>18</option>\
                            <option value='19'>19</option>\
                            <option value='20'>20</option>\
                            <option value='21'>21</option>\
                            <option value='22'>22</option>\
                            <option value='23'>23</option>\
                          </select>\
                        <label for='minutoON2'>MinutoON2:</label>\
                        <select name='minutoON2' id='minutoON2'>\
                            <option value='00'>00</option>\
                            <option value='01'>01</option>\
                            <option value='02'>02</option>\
                            <option value='03'>03</option>\
                            <option value='04'>04</option>\
                            <option value='05'>05</option>\
                            <option value='06'>06</option>\
                            <option value='07'>07</option>\
                            <option value='08'>08</option>\
                            <option value='09'>09</option>\
                            <option value='10'>10</option>\
                            <option value='11'>11</option>\
                            <option value='12'>12</option>\
                            <option value='13'>13</option>\
                            <option value='14'>14</option>\
                            <option value='15'>15</option>\
                            <option value='16'>16</option>\
                            <option value='17'>17</option>\
                            <option value='18'>18</option>\
                            <option value='19'>19</option>\
                            <option value='20'>20</option>\
                            <option value='21'>21</option>\
                            <option value='22'>22</option>\
                            <option value='23'>23</option>\
                            <option value='24'>24</option>\
                            <option value='25'>25</option>\
                            <option value='26'>26</option>\
                            <option value='27'>27</option>\
                            <option value='28'>28</option>\
                            <option value='29'>29</option>\
                            <option value='30'>30</option>\
                            <option value='31'>31</option>\
                            <option value='32'>32</option>\
                            <option value='33'>33</option>\
                            <option value='34'>34</option>\
                            <option value='35'>35</option>\
                            <option value='36'>36</option>\
                            <option value='37'>37</option>\
                            <option value='38'>38</option>\
                            <option value='39'>39</option>\
                            <option value='40'>40</option>\
                            <option value='41'>41</option>\
                            <option value='42'>42</option>\
                            <option value='43'>43</option>\
                            <option value='44'>44</option>\
                            <option value='45'>45</option>\
                            <option value='46'>46</option>\
                            <option value='47'>47</option>\
                            <option value='48'>48</option>\
                            <option value='49'>49</option>\
                            <option value='50'>50</option>\
                            <option value='51'>51</option>\
                            <option value='52'>52</option>\
                            <option value='53'>53</option>\
                            <option value='54'>54</option>\
                            <option value='55'>55</option>\
                            <option value='56'>56</option>\
                            <option value='57'>57</option>\
                            <option value='58'>58</option>\
                            <option value='59'>59</option>\
                          </select>\
                          <br>\
                          <label for='horaOFF2'>HoraOFF2:</label>\
                          <select name='horaOFF2' id='horaOFF2'>\
                            <option value='00'>00</option>\
                            <option value='01'>01</option>\
                            <option value='02'>02</option>\
                            <option value='03'>03</option>\
                            <option value='04'>04</option>\
                            <option value='05'>05</option>\
                            <option value='06'>06</option>\
                            <option value='07'>07</option>\
                            <option value='08'>08</option>\
                            <option value='09'>09</option>\
                            <option value='10'>10</option>\
                            <option value='11'>11</option>\
                            <option value='12'>12</option>\
                            <option value='13'>13</option>\
                            <option value='14'>14</option>\
                            <option value='15'>15</option>\
                            <option value='16'>16</option>\
                            <option value='17'>17</option>\
                            <option value='18'>18</option>\
                            <option value='19'>19</option>\
                            <option value='20'>20</option>\
                            <option value='21'>21</option>\
                            <option value='22'>22</option>\
                            <option value='23'>23</option>\
                          </select>\
                        <label for='minutoOFF2'>MinutoOFF2:</label>\
                        <select name='minutoOFF2' id='minutoOFF2'>\
                            <option value='00'>00</option>\
                            <option value='01'>01</option>\
                            <option value='02'>02</option>\
                            <option value='03'>03</option>\
                            <option value='04'>04</option>\
                            <option value='05'>05</option>\
                            <option value='06'>06</option>\
                            <option value='07'>07</option>\
                            <option value='08'>08</option>\
                            <option value='09'>09</option>\
                            <option value='10'>10</option>\
                            <option value='11'>11</option>\
                            <option value='12'>12</option>\
                            <option value='13'>13</option>\
                            <option value='14'>14</option>\
                            <option value='15'>15</option>\
                            <option value='16'>16</option>\
                            <option value='17'>17</option>\
                            <option value='18'>18</option>\
                            <option value='19'>19</option>\
                            <option value='20'>20</option>\
                            <option value='21'>21</option>\
                            <option value='22'>22</option>\
                            <option value='23'>23</option>\
                            <option value='24'>24</option>\
                            <option value='25'>25</option>\
                            <option value='26'>26</option>\
                            <option value='27'>27</option>\
                            <option value='28'>28</option>\
                            <option value='29'>29</option>\
                            <option value='30'>30</option>\
                            <option value='31'>31</option>\
                            <option value='32'>32</option>\
                            <option value='33'>33</option>\
                            <option value='34'>34</option>\
                            <option value='35'>35</option>\
                            <option value='36'>36</option>\
                            <option value='37'>37</option>\
                            <option value='38'>38</option>\
                            <option value='39'>39</option>\
                            <option value='40'>40</option>\
                            <option value='41'>41</option>\
                            <option value='42'>42</option>\
                            <option value='43'>43</option>\
                            <option value='44'>44</option>\
                            <option value='45'>45</option>\
                            <option value='46'>46</option>\
                            <option value='47'>47</option>\
                            <option value='48'>48</option>\
                            <option value='49'>49</option>\
                            <option value='50'>50</option>\
                            <option value='51'>51</option>\
                            <option value='52'>52</option>\
                            <option value='53'>53</option>\
                            <option value='54'>54</option>\
                            <option value='55'>55</option>\
                            <option value='56'>56</option>\
                            <option value='57'>57</option>\
                            <option value='58'>58</option>\
                            <option value='59'>59</option>\
                          </select>\
                          <br>\
                          <br>\
                        <label for='horaON3'>HoraON3:</label>\
                          <select name='horaON3' id='horaON3'>\
                            <option value='00'>00</option>\
                            <option value='01'>01</option>\
                            <option value='02'>02</option>\
                            <option value='03'>03</option>\
                            <option value='04'>04</option>\
                            <option value='05'>05</option>\
                            <option value='06'>06</option>\
                            <option value='07'>07</option>\
                            <option value='08'>08</option>\
                            <option value='09'>09</option>\
                            <option value='10'>10</option>\
                            <option value='11'>11</option>\
                            <option value='12'>12</option>\
                            <option value='13'>13</option>\
                            <option value='14'>14</option>\
                            <option value='15'>15</option>\
                            <option value='16'>16</option>\
                            <option value='17'>17</option>\
                            <option value='18'>18</option>\
                            <option value='19'>19</option>\
                            <option value='20'>20</option>\
                            <option value='21'>21</option>\
                            <option value='22'>22</option>\
                            <option value='23'>23</option>\
                          </select>\
                        <label for='minutoON3'>MinutoON3:</label>\
                        <select name='minutoON3' id='minutoON3'>\
                            <option value='00'>00</option>\
                            <option value='01'>01</option>\
                            <option value='02'>02</option>\
                            <option value='03'>03</option>\
                            <option value='04'>04</option>\
                            <option value='05'>05</option>\
                            <option value='06'>06</option>\
                            <option value='07'>07</option>\
                            <option value='08'>08</option>\
                            <option value='09'>09</option>\
                            <option value='10'>10</option>\
                            <option value='11'>11</option>\
                            <option value='12'>12</option>\
                            <option value='13'>13</option>\
                            <option value='14'>14</option>\
                            <option value='15'>15</option>\
                            <option value='16'>16</option>\
                            <option value='17'>17</option>\
                            <option value='18'>18</option>\
                            <option value='19'>19</option>\
                            <option value='20'>20</option>\
                            <option value='21'>21</option>\
                            <option value='22'>22</option>\
                            <option value='23'>23</option>\
                            <option value='24'>24</option>\
                            <option value='25'>25</option>\
                            <option value='26'>26</option>\
                            <option value='27'>27</option>\
                            <option value='28'>28</option>\
                            <option value='29'>29</option>\
                            <option value='30'>30</option>\
                            <option value='31'>31</option>\
                            <option value='32'>32</option>\
                            <option value='33'>33</option>\
                            <option value='34'>34</option>\
                            <option value='35'>35</option>\
                            <option value='36'>36</option>\
                            <option value='37'>37</option>\
                            <option value='38'>38</option>\
                            <option value='39'>39</option>\
                            <option value='40'>40</option>\
                            <option value='41'>41</option>\
                            <option value='42'>42</option>\
                            <option value='43'>43</option>\
                            <option value='44'>44</option>\
                            <option value='45'>45</option>\
                            <option value='46'>46</option>\
                            <option value='47'>47</option>\
                            <option value='48'>48</option>\
                            <option value='49'>49</option>\
                            <option value='50'>50</option>\
                            <option value='51'>51</option>\
                            <option value='52'>52</option>\
                            <option value='53'>53</option>\
                            <option value='54'>54</option>\
                            <option value='55'>55</option>\
                            <option value='56'>56</option>\
                            <option value='57'>57</option>\
                            <option value='58'>58</option>\
                            <option value='59'>59</option>\
                          </select>\
                          <br>\
                          <label for='horaOFF3'>HoraOFF3:</label>\
                          <select name='horaOFF3' id='horaOFF3'>\
                            <option value='00'>00</option>\
                            <option value='01'>01</option>\
                            <option value='02'>02</option>\
                            <option value='03'>03</option>\
                            <option value='04'>04</option>\
                            <option value='05'>05</option>\
                            <option value='06'>06</option>\
                            <option value='07'>07</option>\
                            <option value='08'>08</option>\
                            <option value='09'>09</option>\
                            <option value='10'>10</option>\
                            <option value='11'>11</option>\
                            <option value='12'>12</option>\
                            <option value='13'>13</option>\
                            <option value='14'>14</option>\
                            <option value='15'>15</option>\
                            <option value='16'>16</option>\
                            <option value='17'>17</option>\
                            <option value='18'>18</option>\
                            <option value='19'>19</option>\
                            <option value='20'>20</option>\
                            <option value='21'>21</option>\
                            <option value='22'>22</option>\
                            <option value='23'>23</option>\
                          </select>\
                        <label for='minutoOFF3'>MinutoOFF3:</label>\
                        <select name='minutoOFF3' id='minutoOFF3'>\
                            <option value='00'>00</option>\
                            <option value='01'>01</option>\
                            <option value='02'>02</option>\
                            <option value='03'>03</option>\
                            <option value='04'>04</option>\
                            <option value='05'>05</option>\
                            <option value='06'>06</option>\
                            <option value='07'>07</option>\
                            <option value='08'>08</option>\
                            <option value='09'>09</option>\
                            <option value='10'>10</option>\
                            <option value='11'>11</option>\
                            <option value='12'>12</option>\
                            <option value='13'>13</option>\
                            <option value='14'>14</option>\
                            <option value='15'>15</option>\
                            <option value='16'>16</option>\
                            <option value='17'>17</option>\
                            <option value='18'>18</option>\
                            <option value='19'>19</option>\
                            <option value='20'>20</option>\
                            <option value='21'>21</option>\
                            <option value='22'>22</option>\
                            <option value='23'>23</option>\
                            <option value='24'>24</option>\
                            <option value='25'>25</option>\
                            <option value='26'>26</option>\
                            <option value='27'>27</option>\
                            <option value='28'>28</option>\
                            <option value='29'>29</option>\
                            <option value='30'>30</option>\
                            <option value='31'>31</option>\
                            <option value='32'>32</option>\
                            <option value='33'>33</option>\
                            <option value='34'>34</option>\
                            <option value='35'>35</option>\
                            <option value='36'>36</option>\
                            <option value='37'>37</option>\
                            <option value='38'>38</option>\
                            <option value='39'>39</option>\
                            <option value='40'>40</option>\
                            <option value='41'>41</option>\
                            <option value='42'>42</option>\
                            <option value='43'>43</option>\
                            <option value='44'>44</option>\
                            <option value='45'>45</option>\
                            <option value='46'>46</option>\
                            <option value='47'>47</option>\
                            <option value='48'>48</option>\
                            <option value='49'>49</option>\
                            <option value='50'>50</option>\
                            <option value='51'>51</option>\
                            <option value='52'>52</option>\
                            <option value='53'>53</option>\
                            <option value='54'>54</option>\
                            <option value='55'>55</option>\
                            <option value='56'>56</option>\
                            <option value='57'>57</option>\
                            <option value='58'>58</option>\
                            <option value='59'>59</option>\
                          </select>\
                          <br>\
                          <br>\
                          <label for='horaON4'>HoraON4:</label>\
                          <select name='horaON4' id='horaON4'>\
                            <option value='00'>00</option>\
                            <option value='01'>01</option>\
                            <option value='02'>02</option>\
                            <option value='03'>03</option>\
                            <option value='04'>04</option>\
                            <option value='05'>05</option>\
                            <option value='06'>06</option>\
                            <option value='07'>07</option>\
                            <option value='08'>08</option>\
                            <option value='09'>09</option>\
                            <option value='10'>10</option>\
                            <option value='11'>11</option>\
                            <option value='12'>12</option>\
                            <option value='13'>13</option>\
                            <option value='14'>14</option>\
                            <option value='15'>15</option>\
                            <option value='16'>16</option>\
                            <option value='17'>17</option>\
                            <option value='18'>18</option>\
                            <option value='19'>19</option>\
                            <option value='20'>20</option>\
                            <option value='21'>21</option>\
                            <option value='22'>22</option>\
                            <option value='23'>23</option>\
                          </select>\
                        <label for='minutoON4'>MinutoON4:</label>\
                        <select name='minutoON4' id='minutoON4'>\
                            <option value='00'>00</option>\
                            <option value='01'>01</option>\
                            <option value='02'>02</option>\
                            <option value='03'>03</option>\
                            <option value='04'>04</option>\
                            <option value='05'>05</option>\
                            <option value='06'>06</option>\
                            <option value='07'>07</option>\
                            <option value='08'>08</option>\
                            <option value='09'>09</option>\
                            <option value='10'>10</option>\
                            <option value='11'>11</option>\
                            <option value='12'>12</option>\
                            <option value='13'>13</option>\
                            <option value='14'>14</option>\
                            <option value='15'>15</option>\
                            <option value='16'>16</option>\
                            <option value='17'>17</option>\
                            <option value='18'>18</option>\
                            <option value='19'>19</option>\
                            <option value='20'>20</option>\
                            <option value='21'>21</option>\
                            <option value='22'>22</option>\
                            <option value='23'>23</option>\
                            <option value='24'>24</option>\
                            <option value='25'>25</option>\
                            <option value='26'>26</option>\
                            <option value='27'>27</option>\
                            <option value='28'>28</option>\
                            <option value='29'>29</option>\
                            <option value='30'>30</option>\
                            <option value='31'>31</option>\
                            <option value='32'>32</option>\
                            <option value='33'>33</option>\
                            <option value='34'>34</option>\
                            <option value='35'>35</option>\
                            <option value='36'>36</option>\
                            <option value='37'>37</option>\
                            <option value='38'>38</option>\
                            <option value='39'>39</option>\
                            <option value='40'>40</option>\
                            <option value='41'>41</option>\
                            <option value='42'>42</option>\
                            <option value='43'>43</option>\
                            <option value='44'>44</option>\
                            <option value='45'>45</option>\
                            <option value='46'>46</option>\
                            <option value='47'>47</option>\
                            <option value='48'>48</option>\
                            <option value='49'>49</option>\
                            <option value='50'>50</option>\
                            <option value='51'>51</option>\
                            <option value='52'>52</option>\
                            <option value='53'>53</option>\
                            <option value='54'>54</option>\
                            <option value='55'>55</option>\
                            <option value='56'>56</option>\
                            <option value='57'>57</option>\
                            <option value='58'>58</option>\
                            <option value='59'>59</option>\
                          </select>\
                          <br>\
                        <label for='horaOFF4'>HoraOFF4:</label>\
                          <select name='horaOFF4' id='horaOFF4'>\
                            <option value='00'>00</option>\
                            <option value='01'>01</option>\
                            <option value='02'>02</option>\
                            <option value='03'>03</option>\
                            <option value='04'>04</option>\
                            <option value='05'>05</option>\
                            <option value='06'>06</option>\
                            <option value='07'>07</option>\
                            <option value='08'>08</option>\
                            <option value='09'>09</option>\
                            <option value='10'>10</option>\
                            <option value='11'>11</option>\
                            <option value='12'>12</option>\
                            <option value='13'>13</option>\
                            <option value='14'>14</option>\
                            <option value='15'>15</option>\
                            <option value='16'>16</option>\
                            <option value='17'>17</option>\
                            <option value='18'>18</option>\
                            <option value='19'>19</option>\
                            <option value='20'>20</option>\
                            <option value='21'>21</option>\
                            <option value='22'>22</option>\
                            <option value='23'>23</option>\
                          </select>\
                        <label for='minutoOFF4'>MinutoOFF4:</label>\
                        <select name='minutoOFF4' id='minutoOFF4'>\
                            <option value='00'>00</option>\
                            <option value='01'>01</option>\
                            <option value='02'>02</option>\
                            <option value='03'>03</option>\
                            <option value='04'>04</option>\
                            <option value='05'>05</option>\
                            <option value='06'>06</option>\
                            <option value='07'>07</option>\
                            <option value='08'>08</option>\
                            <option value='09'>09</option>\
                            <option value='10'>10</option>\
                            <option value='11'>11</option>\
                            <option value='12'>12</option>\
                            <option value='13'>13</option>\
                            <option value='14'>14</option>\
                            <option value='15'>15</option>\
                            <option value='16'>16</option>\
                            <option value='17'>17</option>\
                            <option value='18'>18</option>\
                            <option value='19'>19</option>\
                            <option value='20'>20</option>\
                            <option value='21'>21</option>\
                            <option value='22'>22</option>\
                            <option value='23'>23</option>\
                            <option value='24'>24</option>\
                            <option value='25'>25</option>\
                            <option value='26'>26</option>\
                            <option value='27'>27</option>\
                            <option value='28'>28</option>\
                            <option value='29'>29</option>\
                            <option value='30'>30</option>\
                            <option value='31'>31</option>\
                            <option value='32'>32</option>\
                            <option value='33'>33</option>\
                            <option value='34'>34</option>\
                            <option value='35'>35</option>\
                            <option value='36'>36</option>\
                            <option value='37'>37</option>\
                            <option value='38'>38</option>\
                            <option value='39'>39</option>\
                            <option value='40'>40</option>\
                            <option value='41'>41</option>\
                            <option value='42'>42</option>\
                            <option value='43'>43</option>\
                            <option value='44'>44</option>\
                            <option value='45'>45</option>\
                            <option value='46'>46</option>\
                            <option value='47'>47</option>\
                            <option value='48'>48</option>\
                            <option value='49'>49</option>\
                            <option value='50'>50</option>\
                            <option value='51'>51</option>\
                            <option value='52'>52</option>\
                            <option value='53'>53</option>\
                            <option value='54'>54</option>\
                            <option value='55'>55</option>\
                            <option value='56'>56</option>\
                            <option value='57'>57</option>\
                            <option value='58'>58</option>\
                            <option value='59'>59</option>\
                          </select>\
                          <br>\
                          <input type='checkbox' name='preset1' value='ON'>\
                          <label for='preset1'> Activar preset 1</label><br>\
                          <input type='checkbox' name='preset2' value='ON'>\
                          <label for='preset2'> Activar preset 2</label><br>\
                          <input type='checkbox' name='preset3' value='ON'>\
                          <label for='preset3'> Activar preset 3</label><br>\
                          <input type='checkbox' name='preset4' value='ON'>\
                          <label for='preset4'> Activar preset 4</label><br>\
                          <br>\
                        <input type='submit' value='Aceptar'>\
                      </form>" + endHtml;

  
  //server.send(200, "text/plain", "hello from esp32!");
  server.send(200, "text/html", htmlToSend);
  //delay(500);
  //digitalWrite(led, 0);
}

void handleMenu() {
  //digitalWrite(led, 1);
  
  horaON1 = server.arg(0);
  minutoON1 = server.arg(1);
  horaOFF1 = server.arg(2);
  minutoOFF1 = server.arg(3);
  horaON2 = server.arg(4);
  minutoON2 = server.arg(5);
  horaOFF2 = server.arg(6);
  minutoOFF2 = server.arg(7);
  horaON3 = server.arg(8);
  minutoON3 = server.arg(9);
  horaOFF3 = server.arg(10);
  minutoOFF3 = server.arg(11);
  horaON4 = server.arg(12);
  minutoON4 = server.arg(13);
  horaOFF4 = server.arg(14);
  minutoOFF4 = server.arg(15);
  preset1 = server.arg(16);
  preset2 = server.arg(17);
  preset3 = server.arg(18);
  preset4 = server.arg(19);

  Serial.print("HoraON1 = ");
  Serial.println(horaON1);
  Serial.print("MinutoON1 = ");
  Serial.println(minutoON1);
  Serial.print("HoraOFF1 = ");
  Serial.println(horaOFF1);
  Serial.print("MinutoOFF1 = ");
  Serial.println(minutoOFF1);

  Serial.print("HoraON2 = ");
  Serial.println(horaON2);
  Serial.print("MinutoON2 = ");
  Serial.println(minutoON2);
  Serial.print("HoraOFF2 = ");
  Serial.println(horaOFF2);
  Serial.print("MinutoOFF2 = ");
  Serial.println(minutoOFF2);

  Serial.print("HoraON3 = ");
  Serial.println(horaON3);
  Serial.print("MinutoON3 = ");
  Serial.println(minutoON3);
  Serial.print("HoraOFF3 = ");
  Serial.println(horaOFF3);
  Serial.print("MinutoOFF3 = ");
  Serial.println(minutoOFF3);

  Serial.print("HoraON4 = ");
  Serial.println(horaON4);
  Serial.print("MinutoON4 = ");
  Serial.println(minutoON4);
  Serial.print("HoraOFF4 = ");
  Serial.println(horaOFF4);
  Serial.print("MinutoOFF4 = ");
  Serial.println(minutoOFF4);

  Serial.print("preset1 = ");
  Serial.println(preset1);
  Serial.print("preset2 = ");
  Serial.println(preset2);
  Serial.print("preset3 = ");
  Serial.println(preset3);
  Serial.print("preset4 = ");
  Serial.println(preset4);

  
 



  if(preset1 = "ON"){

    tiempoConfiguradoON1 = horaON1 + ":" + minutoON1 + ":" + "00";
    tiempoConfiguradoOFF1 = horaOFF1 + ":" + minutoOFF1 + ":" + "00";

    EEPROM.writeString(EEPROM_tiempoConfiguradoON1, tiempoConfiguradoON1);
    EEPROM.commit();
    EEPROM.writeString(EEPROM_tiempoConfiguradoOFF1, tiempoConfiguradoOFF1);
    EEPROM.commit();
/*
    writeString(EEPROM_tiempoConfiguradoON1, tiempoConfiguradoON1);
    EEPROM.commit();
    delay(100);
    writeString(EEPROM_tiempoConfiguradoOFF1, tiempoConfiguradoOFF1);
    EEPROM.commit();
    delay(100);
*/
  }
  if(preset2 = "ON"){

    tiempoConfiguradoON2 = horaON2 + ":" + minutoON2 + ":" + "00";
    tiempoConfiguradoOFF2 = horaOFF2 + ":" + minutoOFF2 + ":" + "00";


    EEPROM.writeString(EEPROM_tiempoConfiguradoON2, tiempoConfiguradoON2);
    EEPROM.commit();
    EEPROM.writeString(EEPROM_tiempoConfiguradoOFF2, tiempoConfiguradoOFF2);
    EEPROM.commit();
/*
    writeString(EEPROM_tiempoConfiguradoON2, tiempoConfiguradoON2);
    EEPROM.commit();
    delay(100);
    writeString(EEPROM_tiempoConfiguradoOFF2, tiempoConfiguradoOFF2);
    EEPROM.commit();
    delay(100);
*/
  }
  if(preset3 = "ON"){
 
    tiempoConfiguradoON3 = horaON3 + ":" + minutoON3 + ":" + "00";
    tiempoConfiguradoOFF3 = horaOFF3 + ":" + minutoOFF3 + ":" + "00";

    EEPROM.writeString(EEPROM_tiempoConfiguradoON3, tiempoConfiguradoON3);
    EEPROM.commit();
    EEPROM.writeString(EEPROM_tiempoConfiguradoOFF3, tiempoConfiguradoOFF3);
    EEPROM.commit();
/*
    writeString(EEPROM_tiempoConfiguradoON3, tiempoConfiguradoON3);
    EEPROM.commit();
    delay(100);
    writeString(EEPROM_tiempoConfiguradoOFF3, tiempoConfiguradoOFF3);
    EEPROM.commit();
    delay(100);
  */  
  }
  if(preset4 = "ON"){

    tiempoConfiguradoON4 = horaON4 + ":" + minutoON4 + ":" + "00";
    tiempoConfiguradoOFF4 = horaOFF4 + ":" + minutoOFF4 + ":" + "00";
    
    EEPROM.writeString(EEPROM_tiempoConfiguradoON4, tiempoConfiguradoON4);
    EEPROM.commit();
    EEPROM.writeString(EEPROM_tiempoConfiguradoOFF4, tiempoConfiguradoOFF4);
    EEPROM.commit();
/*
    writeString(EEPROM_tiempoConfiguradoON4, tiempoConfiguradoON4);
    EEPROM.commit();
    delay(100);
    writeString(EEPROM_tiempoConfiguradoOFF4, tiempoConfiguradoOFF4);
    EEPROM.commit();
    delay(100);
    */
  }


  //EEPROM.write(17, '\0');
  //EEPROM.commit();


  String botonVolver = "<form action = '/' method = 'POST'>\
                        <input type='submit' value='Volver'>\
                        </form>";

  //String htmlToSend = startHtml + "<h1>Menu</h1><br><h2>tiempoConfigurado</h2><br><p>ON1: " + tiempoConfiguradoON1 + "</p><br>" + "<p>OFF1: " + tiempoConfiguradoOFF1 + "</p>" + "<h2>tiempoConfigurado</h2><br><p>ON2: " + tiempoConfiguradoON2 + "</p><br>" + "<p>OFF2: " + tiempoConfiguradoOFF2 + "</p>" + "<h2>tiempoConfigurado</h2><br><p>ON3: " + tiempoConfiguradoON3 + "</p><br>" + "<p>OFF3: " + tiempoConfiguradoOFF3 + "</p>" + "<h2>tiempoConfigurado</h2><br><p>ON4: " + tiempoConfiguradoON4 + "</p><br>" + "<p>OFF4: " + tiempoConfiguradoOFF4 + "</p>" + "<form action = '/' method = 'POST'><input type='submit' value='Volver'></form>" + endHtml;
  //String htmlToSend = startHtml + "<form action = '/' method = 'POST'><input type='submit' value='Volver'></form>" + endHtml;
  
  String htmlToSend = startHtml + 
                      "<h1>Menu</h1><br><h2>Preset 1</h2><p>ON1: " +
                      tiempoConfiguradoON1 + " ---- " + "OFF1: " + tiempoConfiguradoOFF1 + 
                      "</p>" + "<h2>Preset 2</h2><p>ON2: " + tiempoConfiguradoON2 + 
                      " ---- " + "OFF2: " + tiempoConfiguradoOFF2 + "</p>" + 
                      "<h2>Preset 3</h2><p>ON3: " + tiempoConfiguradoON3 + 
                      " ---- " + "OFF3: " + tiempoConfiguradoOFF3 + "</p>" + 
                      "<h2>Preset 4</h2><p>ON4: " + tiempoConfiguradoON4 + 
                      " ---- " + "OFF4: " + tiempoConfiguradoOFF4 + "</p>" +
                      botonVolver + endHtml;

                      
  //server.send(200, "text/plain", "hello from esp32!");
  server.send(200, "text/html", htmlToSend);
  //delay(500);
  //digitalWrite(led, 0);
}

void handleNotFound() {
  digitalWrite(led, 1);
  String message = "File Not Found\n\n";
  message += "URI: ";
  message += server.uri();
  message += "\nMethod: ";
  message += (server.method() == HTTP_GET) ? "GET" : "POST";
  message += "\nArguments: ";
  message += server.args();
  message += "\n";
  for (uint8_t i = 0; i < server.args(); i++) {
    message += " " + server.argName(i) + ": " + server.arg(i) + "\n";
  }
  server.send(404, "text/plain", message);
  digitalWrite(led, 0);
}
